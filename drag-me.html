<!DOCTYPE html lang="zh">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>search listed address, since 2022 March 18th</title>
  <script src="full.json?v=0412"></script>
  <script>
  let i; let j; let As; let Ds;
  function load () {
    j = JSON.parse(data);
    datestr.textContent = j.date;
    let k;
    Ds = Object.keys(j.districts);
    As = Object.keys(j.address);
    console.log( j.address['shanghaifabu'] );
    for (i = 0; i < Ds.length; i += 1) {
      k = document.createElement('tr');
      k.id = Ds[i];
      k.innerHTML = '<tr><td>' + Ds[i] + '</td><td>' +
                    j.latest[ Ds[i] ].length + '</td><td>' +
                    j.districts[ Ds[i] ].length + '</td><td style="color:green;">' +
                    j.released[ Ds[i] ].length + '</td></tr>';
      districtTable.appendChild(k);
      k = document.createElement('p');
      k.innerHTML = '<span style="color:black;">' + Ds[i] + ':</span> ' + j.released[ Ds[i] ];
      released.appendChild(k);
    }
  }
  function search () {
    let k = addr.value;
    if (k === '') {
      addr.focus();
      return;
    }
    console.log(k);
    onList.textContent = '';
    for (ii = 0; ii < Ds.length; ii += 1) {
      document.getElementById(Ds[ii]).style.background = 'white';
    }
    let dl; let kk; let ks;
    for (i = 0; i < As.length; i += 1) {
      if (As[i].indexOf(k) > -1) {
        dl = j.address[ As[i] ];
        let ii; let ij; let ik; let il = false;
        for (ii = 0; ii < Ds.length; ii += 1) {
          ij = j.districts[ Ds[ii] ];
          for (ik = 0; ik < ij.length; ik += 1) {
            if (ij[ik] === As[i]) {
              document.getElementById(Ds[ii]).style.background = 'yellow';
              //console.log(Ds[ii]);
              il = true;
              break;
            }
          }
          if (il) { break; }
        }
        //onList.textContent += Ds[ii] + ',' + As[i] + ': ' + dl;
        ks = '<span>' + Ds[ii] +
             '<a href="https://maps.baidu.com/search/?querytype=s&wd=' +
                        As[i] + '" target="_blank">' +
                        As[i] + '</a>' + ': ' + dl;
        const release = parseInt(dl[dl.length - 1]) + 14 - 400;
        if (release < 1) {
          ks += ' 已经解封</span>';
        } else if (release < 31) {
          //onList.textContent += ' --> 4/' + release + '\n';
          ks += ' &rarr; <em>4/' + release + '</em></span>';
        } else {
          //onList.textContent += ' --> 5/' + (release-30) + '\n';
          ks += ' &rarr; <em>5/' + (release-30) + '</em></span>';
        }
        let kk = document.createElement('p');
        //kk.id = As[i];
        kk.style.padding = '0';
        kk.style.margin = '0';
        kk.innerHTML = ks;
        onList.appendChild(kk);
      }
    }
  }
  </script>
</head>
<body onload="load()">
  <p>
    数据更新时间 <span id="datestr" style="color:blue;">fetching... not ready</span>
  </p>
  <p>
    <label for="addr">上榜地址</label>
    <input type="text" id="addr" name="addr" />
    <button onclick="search();">搜索</button>
  </p>
  <div style="width:100%;color:blue;" id="onList"></div>
  <h2>各区统计</h2>
  <table id="districtTable" style="border:1px solid blue;color:blue;font-size:75%;text-align:center;">
    <tr style="color:black;"><th>行政单位</th><th>0412新增</th><th>上榜合计</th><th>预计下榜</th></tr>
  </table>
  <h2>预计下榜的地址</h2>
  <div style="color:green;list-style-type:none;font-size:75%;" id="released"></div>
</body>
