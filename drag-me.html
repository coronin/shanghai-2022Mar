<!DOCTYPE html lang="zh">
<head>
  <title>search listed address in shanghai, since 2022 March</title>
  <meta charset="UTF-8">
  <script src="full.json?v=0412"></script>
  <script>
  let i; let j; let As; let Ds;
  function load () {
    j = JSON.parse(data);
    datestr.textContent = j.date;
    let k;
    Ds = Object.keys(j.districts);
    As = Object.keys(j.address);
    console.log( j.address['shanghaifabu'] );
    for (i = 0; i < Ds.length; i += 1) {
      k = document.createElement('tr');
      k.id = Ds[i];
      k.innerHTML = '<tr><td>' + Ds[i] + '</td><td>' +
                    j.latest[ Ds[i] ].length + '</td><td>' +
                    j.districts[ Ds[i] ].length + '</td><td style="color:green;">' +
                    j.released[ Ds[i] ].length + '</td></tr>';
      districtTable.appendChild(k);
      k = document.createElement('p');
      k.innerHTML = '<span style="color:black;">' + Ds[i] + ':</span> ' + j.released[ Ds[i] ];
      released.appendChild(k);
    }
  }
  function search () {
    let k = addr.value;
    if (k === '') {
      addr.focus();
      return;
    }
    console.log(k);
    onList.textContent = '';
    for (ii = 0; ii < Ds.length; ii += 1) {
      document.getElementById(Ds[ii]).style.background = 'white';
    }
    let dl;
    for (i = 0; i < As.length; i += 1) {
      if (As[i].indexOf(k) > -1) {
        dl = j.address[ As[i] ];
        let ii; let ij; let ik; let il = false;
        for (ii = 0; ii < Ds.length; ii += 1) {
          ij = j.districts[ Ds[ii] ];
          for (ik = 0; ik < ij.length; ik += 1) {
            if (ij[ik] === As[i]) {
              document.getElementById(Ds[ii]).style.background = 'yellow';
              //console.log(Ds[ii]);
              il = true;
              break;
            }
          }
          if (il) { break; }
        }
        onList.textContent += Ds[ii] + ',' + As[i] + ': ' + dl;
        const release = parseInt(dl[dl.length - 1]) + 14 - 400;
        if (release < 31) {
          onList.textContent += ' --> 4/' + release + '\n';
        } else {
          onList.textContent += ' --> 5/' + (release-30) + '\n';
        }
      }
    }
  }
  </script>
</head>
<body onload="load()">
  <p>
    数据更新时间 <span id="datestr" style="color:blue;"></span>
  </p>
  <p>
    <label for="addr">上榜地址</label>
    <input type="text" id="addr" name="addr" />
    <button onclick="search();">搜索</button>
  </p>
  <pre style="width:100%;color:blue;" id="onList"></pre>
  <table id="districtTable" style="border:1px solid blue;color:blue;font-size:75%;text-align:center;">
    <tr style="color:black;"><th>行政单位</th><th>0412新增</th><th>上榜合计</th><th>预计下榜</th></tr>
  </table>
  <p><br/><br/>预计下榜的地址</p>
  <div style="color:green;list-style-type:none;font-size:75%;" id="released"></div>
</body>
