<!DOCTYPE html lang="zh">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>d3js listed address</title>
  <script src="d3.min.v3.js"></script>
  <script src="d3.geo.projection.min.v0.js"></script>
  <script src="topojson.min.180.js"></script>
  <script src="sh.topojson?v=0430"></script>
  <script>
  function load () {
    const svgWidth = 500,
          svgHeight = 500;
    //const pj = d3.geo.kavrayskiy7(),
    const pj = d3.geo.mercator().scale(20000
                ).center([121.43752, 31.179973]
                ).translate([svgWidth/2, svgHeight/2]);
    const dc = d3.scale.category20();
    //      g = d3.geo.graticule();
    const pg = d3.geo.path().projection(pj);
    const svg = d3.select('#app').append('svg'
                 ).attr('width', svgWidth
                 ).attr('height', svgHeight);
    // svg.append('path').datum(g
    //   ).attr('class', 'grid'
    //   ).attr('d', pg);
    // svg.append('path').datum(g.outline
    //   ).attr('class', 'grid outline'
    //   ).attr('d', pg);
    const j = JSON.parse(data);
    const dt = topojson.feature(j, j.objects.collection).features,
          dn = topojson.neighbors(j.objects.collection.geometries);
    // http://bl.ocks.org/jasondavies/4188334
    svg.selectAll('.district'
      ).data(dt).enter().insert('path', '.grid'
      ).attr('class', 'district'
      ).attr('d', pg).style('fill', function (d, i) {
       return dc(d.color = d3.max(dn[i], function (n) {
       return dt[n].color; }) + 1 | 0);
      });
  }
  </script>
  <style type="text/css">
    body {background-color:white;}
    .district {
      fill: #ccc;
      stroke: #fff;
      stroke-width: .5px;
      stroke-linejoin: round;
    }
  </style>
</head>
<body onload="load();">
  <p>
    数据来源 <a href="https://wsjkw.sh.gov.cn/xwfb/index.html" target="_blank">公众号 shanghaifabu</a>
    </p>
  <div id="app"></div>
</body>
