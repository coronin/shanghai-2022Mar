<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>listed address, since March 6th 2022</title>
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <script src="shanghaifabu/full0714.json"></script><!-- @@ -->
  <script>
  const hot_addr = { // 2022-7-16 7:46
  '浦东新区南码头路街道胶南小区': '0716',
  '静安区芷江西路街道虬江路1489-1499号': '0716',
  '静安区江宁路街道静安枫景苑（武定路801弄、新闸路1550弄）': '0716',
  '长宁区天山路街道古北路181弄1-23号、211弄1-22号，玉屏南路731弄2、4号': '0716',
  '普陀区长风新村街道长风二村风荷苑小区150-157号、163-186号': '0716',
  '虹口区曲阳路街道曲阳路800号': '0716',
  '虹口区四川北路街道四川北路1906弄（1-52号）': '0716',
  '虹口区四川北路街道四平路95号': '0716',
  '虹口区北外滩街道海宁路55号长治公寓': '0716',
  '杨浦区五角场街道国权路29号': '0716',
  '杨浦区大桥街道杭州路741号': '0716',
  '宝山区高境镇共和新路4711-6号、4711-7号、4711-8号': '0716',
  '宝山区高境镇殷高西路215号高景浴场': '0716',
  '宝山区淞南镇新二路1088弄嘉骏花苑居民区': '0716',
  '虹口区四川北路街道四平路59号': '0715', // 高风险
  '浦东新区三林镇同济村果园队': '0715',
  '浦东新区三林镇西泰林路158弄环球翡翠湾': '0715',
  '浦东新区高行镇东沟三村小区': '0715',
  '徐汇区凌云路街道梅陇七村': '0715',
  '静安区彭浦新村街道保德路641弄': '0715',
  '长宁区新华路街道幸福路211弄1号华山夏都苑': '0715',
  '普陀区甘泉路街道黄陵路200弄': '0715',
  '虹口区广中路街道广中路460号': '0715',
  '虹口区广中路街道水电路583弄（1-8号）': '0715',
  '虹口区曲阳路街道密云路471弄（46、48、50、52号）': '0715',
  '虹口区曲阳路街道中山北一路865弄小区': '0715',
  '虹口区欧阳路街道天宝西路252弄（16-19号）': '0715',
  '虹口区欧阳路街道四达路58弄（29号）': '0715',
  '杨浦区殷行街道国和一村122-127号': '0715',
  '杨浦区五角场街道国顺路384-398双号、国顺路400弄': '0715',
  '杨浦区长白新村街道控江路32、34号小区': '0715',
  '杨浦区定海路街道隆昌路235号1号楼': '0715',
  '杨浦区长海路街道中原路28弄1-8号': '0715',
  '杨浦区江浦路街道信通浦皓园二期': '0715',
  '杨浦区控江路街道195街坊第二居委': '0715',
  '闵行区江川路街道华坪路69弄华江小区': '0715',
  '宝山区杨行镇莲花山路517弄西区（37-72号，85-96号，106-117号，130-138号）': '0715',
  '宝山区淞南镇长江路860弄9支弄8-30号': '0715',
  '宝山区淞南镇长江西路755号碧家国际社区': '0715',
  '宝山区顾村镇沈宅村陶家宅1-45号，沈宅村联杨路2447号和联杨路2398号': '0715',
  '宝山区顾村镇陆翔路698弄海尚菊苑北区': '0715',
  '宝山区大场镇环镇北路417弄509弄乾溪三村': '0715',
  '宝山区友谊路街道宝钢二村B区': '0715',
  '宝山区高境镇逸仙路2571号': '0715',
  '浦东新区南码头路街道东三小区': '0714',
  '浦东新区金杨新村街道浦东大道2511弄19-5号（长新汽修厂）': '0714',
  '浦东新区周浦镇韵浦路167弄沈默花苑': '0714',
  '静安区南京西路街道延安中路740弄': '0714',
  '静安区彭浦新村街道保德路1238弄（38号-42号，48号-52号，58号-62号，68号-72号，78号-82号，88号-92号）': '0714',
  '静安区宝山路街道止园路406弄': '0714',
  '静安区宝山路街道宝山路450弄奔腾新干线公寓': '0714',
  '静安区曹家渡街道达安花园二期（长寿路999弄21号-34号）': '0714',
  '静安区共和新路街道洛川东路99号': '0714',
  '普陀区真如镇街道南石二路135号兰溪公寓': '0714',
  '虹口区四川北路街道海伦路555弄小区': '0714',
  '虹口区广中路街道东宝兴路645弄（4-6号）': '0714',
  '杨浦区控江路街道控江路1505弄': '0714',
  '杨浦区江浦路街道辽源三村': '0714',
  '杨浦区大桥街道平凉路1136号': '0714',
  '杨浦区平凉路街道齐齐哈尔路568弄': '0714',
  '闵行区浦锦街道浦江村五、六、七组': '0714',
  '宝山区淞南镇郁江巷路137号桔子公寓': '0714',
  '宝山区杨行镇水产路1458号上海北部物流中心': '0714',
  '浦东新区周浦镇里仁村1101号-1118号区域': '0713',
  '浦东新区北蔡镇中界村复兴队苏家宅': '0713',
  '浦东新区潍坊新村街道浦电路331弄、305弄': '0713',
  '普陀区真如镇街道清涧路187弄（高层）': '0713',
  '虹口区凉城新村街道车站南路291弄（1号）': '0713',
  '虹口区凉城新村街道广粤路439弄（51-54号）': '0713',
  '虹口区江湾镇街道华严路98弄（17-22号）': '0713',
  '杨浦区五角场街道国权后路7号': '0713',
  '杨浦区殷行街道民星二村39-61号': '0713',
  '杨浦区江浦路街道通北路888号': '0713',
  '杨浦区五角场街道国顺路280号': '0713',
  '闵行区华漕镇纪鹤路589弄鹫山村永丰苑小区': '0713',
  '闵行区莘庄镇闵城路199弄好世鹿鸣苑小区': '0713',
  '宝山区友谊路街道密山路密山二村东块B区': '0713',
  '宝山区淞南镇郁江巷路129弄三湘海尚小区': '0713',
  '宝山区庙行镇大康路896弄恒达家园A区（1-22号） ': '0713',
  '宝山区月浦镇绥化路52弄1-39号': '0713',
  '宝山区高境镇共和新路4719弄E区': '0713',
  '金山区山阳镇战斗港路以东、卫清西路以南、杭州湾大道以西、山阳广场以北区域': '0713',
  '青浦区徐泾镇乐天路208弄': '0713',
  '浦东新区南码头路街道浦三路858弄兴荣家园': '0712',
  '黄浦区外滩街道河南中路168号、河南中路166弄居民区': '0712',
  '徐汇区凌云路街道天等路430弄书香苑小区': '0712',
  '普陀区真如镇街道真北路2087弄52支弄': '0712',
  '虹口区北外滩街道霍山路219号': '0712',
  '虹口区江湾镇街道水电路1119弄(7-9号)': '0712',
  '虹口区凉城新村街道凉城路500弄小区': '0712',
  '虹口区四川北路街道四平路59号': '0712',
  '杨浦区江浦路街道飞虹路1047弄': '0712',
  '杨浦区江浦路街道江浦路1199弄': '0712',
  '杨浦区控江路街道195街坊第四居委': '0712',
  '杨浦区四平路街道大连路1548号': '0712',
  '杨浦区殷行街道国和二村155-188号': '0712',
  '闵行区虹桥镇吴中路633弄明申花园小区': '0712',
  '闵行区梅陇镇民建村2组': '0712',

  '宝山区淞南镇淞发路901弄祥腾广场1-7号': '0712',
  '宝山区杨行镇铁峰路2299弄友谊康苑A区（1-17号）': '0712',
  '宝山区张庙街道通河八村西南块': '0712',
  '嘉定区安亭镇漳翔路1165号': '0712',
  '长宁区新华路街道延安西路1558弄14号': '0711', // 高风险
  '浦东新区南码头路街道浦三路111弄5号楼和颐酒店（上海新国际博览中心世博园店）': '0711', // 高风险
  '浦东新区南码头路街道南码头路451弄、浦三路12弄3号、5号、7号、9-16号、21-32号': '0711', // 高风险
  '浦东新区北蔡镇文汇小区南区': '0711',
  '浦东新区东明路街道环林西路848弄红枫苑': '0711',
  '浦东新区高行镇东靖路669弄浦江东旭公寓北区': '0711',
  '浦东新区合庆镇华夏东路2938弄小区': '0711',
  '浦东新区沪东新村街道寿光路78弄小区': '0711',
  '浦东新区花木街道丁香路1089弄小区': '0711',
  '浦东新区金杨新村街道博山东路553弄黄山始信苑': '0711',
  '浦东新区金杨新村街道罗山路665弄小区': '0711',

  '浦东新区三林镇海阳路860弄东旺名苑': '0711',
  '浦东新区周浦镇汇福家园平安里（南区）': '0711',
  '静安区共和新路街道柳营路515弄': '0711',
  '静安区江宁路街道静安豪景苑（康定路501弄、武定路650弄）': '0711',
  '静安区彭浦新村街道三泉路900弄': '0711',
  '虹口区广中路街道西江湾路168弄建玮公寓': '0711',
  '虹口区广中路街道株洲路9弄（4号）': '0711',
  '虹口区江湾镇街道广粤路1401弄小区': '0711',
  '虹口区凉城新村街道车站北路715弄（11-15号）': '0711',
  '虹口区凉城新村街道广灵四路866弄（15-16号）': '0711',
  '虹口区欧阳路街道天宝西路5弄（18号）': '0711',
  '虹口区曲阳路街道伊敏河路50弄（3-4号）': '0711',
  '虹口区曲阳路街道中山北一路865弄21号阜和公寓': '0711',
  '杨浦区江浦路街道辽源四村1-6号、17-22号': '0711',
  '杨浦区江浦路街道许昌路1440弄 ': '0711',

  '杨浦区四平路街道锦西路173号': '0711',
  '杨浦区五角场街道政通路29号': '0711',
  '杨浦区新江湾城街道殷高东路889弄': '0711',

  '宝山区张庙街道虎林路435弄泗塘四村': '0711',
  '宝山区张庙街道泗塘一村南区C块': '0711',
  '嘉定区嘉定工业区沪宜公路3128号绿地嘉尚国际广场': '0711',
  '嘉定区马陆镇立新路80弄嘉新小区1-36号片区': '0711',
  '嘉定区马陆镇云屏路388弄中信泰富嘉苑小区': '0711',
  '嘉定区南翔镇德园路1259弄溪岸澜庭小区': '0711',
  '奉贤区金汇镇长庚路289弄亚通聚秀苑': '0711',
  '徐汇区华泾镇华泾路1000弄': '0710', // 高风险
  '虹口区欧阳路街道东江湾路456号': '0710', // 高风险
  '浦东新区高东镇志伟路880号': '0710',

  '黄浦区半淞园路街道西凌家宅路111弄3号、4号': '0710',

  '黄浦区半淞园路街道西藏南路1090弄（银南大厦）': '0710',
  '徐汇区漕河泾街道漕宝路86号F座': '0710',

  '普陀区长寿路街道常德路1298弄长寿新村': '0710',
  '普陀区长寿路街道居安小区': '0710',
  '虹口区广中路街道西江湾路264弄8-10号': '0710',
  '虹口区曲阳路街道运光路105弄小区': '0710',
  '虹口区四川北路街道四川北路1969号雅雅轻奢酒店': '0710',

  '杨浦区江浦路街道张家浜小区': '0710',

  '闵行区浦江镇江航南路801弄瑞和华苑小区': '0710',

  '闵行区颛桥镇银都路2688弄金盛商业小区': '0710',

  '松江区车墩镇大官塘路180弄松南城善德苑': '0709', // 高风险

  '浦东新区康桥镇环桥路1488弄小区': '0708', // 高风险
  '宝山区大场镇华灵路1900弄金鑫花园D地块': '0708',

  '宝山区罗店镇罗芬路1288弄远洋七号北区（5-30号）': '0708',

  '宝山区友谊街道盘古路689弄同济公寓': '0708',

  '嘉定区真新街道曹安公路1611号5楼e族公寓': '0708',
  '静安区大宁路街道广延路415号': '0708',
  '静安区彭浦镇永灵小区': '0708',

  '浦东新区北蔡镇博华路237弄文化馨苑小区': '0708',
  '浦东新区川沙新镇城丰路15弄小区': '0708',

  '浦东新区花木街道严杨路60弄小区': '0708',

  '浦东新区陆家嘴街道荣成路9弄荣城花苑小区': '0708',

  '黄浦区南京东路街道西藏中路180号高盛商厦5楼（HD PUB汉登喝酒公司人民广场店）': '0707', // 高风险

  '嘉定区南翔镇蕰北公路2371弄浏翔花苑三区小区': '0707',

  '静安区彭浦镇永和路880弄': '0707',
  '静安区天目西路街道普善路128弄（中华新路939弄）': '0707',
  '静安区芷江西路街道大统路1033弄6-8号': '0707',
  '闵行区浦锦街道浦驰路1335弄浦江华侨城四期小区': '0707',
  '闵行区虹桥镇黄桦路85弄龙柏城市花园小区': '0707',
  '闵行区虹桥镇万源路2289弄万源新城三期小区': '0707',
  '闵行区虹桥镇吴中路830弄小区': '0707',
  '闵行区颛桥镇银都路3118弄银都苑小区': '0707',

  '浦东新区曹路镇上川路1755号 ': '0707',
  '浦东新区花木街道牡丹路145弄': '0707',
  '浦东新区祝桥镇星火村（东至星学路，西至南祝路，南至星勤路，北至星火二组支路）': '0707',
  '浦东新区沪东新村街道沪新小区': '0707',

  '普陀区真如镇街道铜川路1781弄': '0707',

  '普陀区长寿路街道光复西路211弄': '0707',
  '普陀区石泉路街道石岚三村（37-50号）': '0707',
  '普陀区石泉路街道管弄路251弄': '0707',
  '普陀区真如镇街道清涧路39弄': '0707',
  '普陀区真如镇街道金汤路353弄': '0707',
  '普陀区真如镇街道兰溪路436号F1精品酒店': '0707',
  '普陀区真如镇街道曹杨路2170弄恒力锦沧花园': '0707',
  '普陀区万里街道紫颐园公寓': '0707',
  '松江区九里亭街道涞寅路658弄绿庭尚城': '0707',

  '杨浦区控江路街道控江四村（欣辉部分）': '0707',
  '长宁区华阳路街道昭化路55弄': '0707',
  '长宁区新华路街道番禺路508号': '0707',

  '宝山区盘古路927弄35-36号': '0705',
  '浦东新区上钢二村': '0704', // 高风险
  '黄浦区建国东路391号浅草37度1皮肤管理定制中心（新天地店）': '0704',

  '普陀区兰溪路148号耕耘茶室': '0703'
  };
  let i; let j; let As; let Ds;
  const today = new Date();

  function trim (s) { return (s || '').replace(/^\s+|\s+$/g, ''); }

  function jtagOffset (dd) {
    let d = parseInt(j.tag) - dd;
    if (331 < d && d <= 400) {
      d -= 69; // 401-14=387(318), 414-14=400(331)
    } else if (430 < d && d <= 500) {
      d -= 70; // 514-14=500(430), 501-14=487(417)
    } else if (531 < d && d <= 600) {
      d -= 69;
    } else if (630 < d && d <= 700) {
      d -= 70;
    }
    return d;
  }

  function dldl (k_, d_) {
    const dl = j.address[d_];
    const s1 = (dl || []).join(',').split(k_);
    let kii; let il = 0;
    for (kii = 0; kii < Ds.length; kii += 1) {
      if (j.districts[ Ds[kii] ].indexOf(d_) > -1) {
        il += 1;
      }
      if (Ds[kii] === k_) { break; }
    }
    let s2; const dldl = [];
    //console.log(k_, d_, il, s1);
    if (il !== 1) { // 地址同名, 团结村 国权北路555 邯郸路20 星火村 五四村
      while (s1.length > 1) {
        s2 = s1.shift();
        if (s2) {
          dldl.push( s2.substr(s2.lastIndexOf(',') + 1) );
        }
      }
    } else {
      for (s2 = 0; s2 < dl.length; s2 += 1) {
        if (dl[s2].length === 4) {
          dldl.push( dl[s2] );
        }
      }
    }
    return dldl;
  }

  function bubble2 (arr, b2 = 1) {
    let done = false; let tmp;
    while (!done) {
      done = true;
      for (i = 1; i < arr.length; i += 1) {
        if (arr[i - 1][b2] < arr[i][b2]) {
          done = false;
          tmp = arr[i - 1];
          arr[i - 1] = arr[i];
          arr[i] = tmp;
        }
      }
    }
  }

  function cacheList () {
    return new Promise(resolve => {
      if (!j.list30times) {
        console.time('>> cache lists ' + j.tag);
        j.list30times = {};
        j.listed_30times_long = [];
        j.first_in = {};
        j.cache14days = {};
        j.cached_14days = [];
        ////if (parseInt(j.tag) > 405) { // 清明假
          j.today = {};
          j.inB = {};
          j.released = {};
          j.released_today = {};
          j.latest_added = {};
          j.latest_added2 = {};
          j.latest_added7 = {};
        ////}
        let j30; let _j30;
        let j0; let jFirst; let j7neg; let j3neg; let j1neg;
        let jA; let jA0; let jB;
        let j14; let _j14;
        Ds.forEach((k) => {
          let kj; let kjj;
          j30 = []; _j30 = [];
          j0 = []; jFirst = []; j7neg = []; j3neg = []; j1neg = [];
          jA = []; jA0 = []; jB = [];
          j14 = []; _j14 = [];
          j.districts[k].forEach((d) => { //Array.from(
            kj = dldl(k, d);
            // .inB   (j.tag + 13)
            // .released
            // .released_today
            if (kj.length >= 30) {
              _j30.push(k + d);
              j30.push( [d, kj.length] );
            }
            if (kj.slice(-1)[0] === j.tag) {
              j0.push(d); // .today
              if (kj.length === 1) {
                jFirst.push(d);
              } else {
                kjj = parseInt(kj.slice(-2)[0]);
                if (kjj < jtagOffset(1)) {
                  j1neg.push(d); }
                if (kjj < jtagOffset(3)) {
                  j3neg.push(d); }
                if (kjj < jtagOffset(7)) {
                  j7neg.push(d);
                }
            } }
            kjj = parseInt(kj.slice(-1)[0]);
            if (kjj <= jtagOffset(14)) {
              jA.push(d);
              if (kjj === jtagOffset(14)) { jA0.push(d); }
            } else {
              jB.push(d);
              kjj = 0;
              kj.forEach((dd) => { //Array.from(
                if (parseInt(dd) > jtagOffset(14)) {
                  kjj += 1; }
              });
              if (kjj >= 7) {
                _j14.push(k + d);
                j14.push( [d, kjj] ); }
            }
          });
          j1neg.push(...jFirst);
          j3neg.push(...jFirst);
          j7neg.push(...jFirst);
          // console.log(k, j.districts[k].length, jB.length, j0.length, jA.length, jA0.length,
          //   '七阴'+j7neg.length, '三阴'+j7neg.length, '昨阴'+j1neg.length,
          //   '月内'+j30.length, '首次'+jFirst.length, '两周内'+j14.length )
          if ([] !== _j30) {
            bubble2(j30);
            j.list30times[k] = j30;
            j.listed_30times_long.push(..._j30);
          }
          if ([] !== jFirst) j.first_in[k] = jFirst;
          if ([] !== _j14) {
            bubble2(j14);
            j.cache14days[k] = j14;
            j.cached_14days.push(..._j14);
          }
          ////if (parseInt(j.tag) > 500) {
            if ([] !== j0) j.today[k] = j0;
            if ([] !== jB) j.inB[k] = jB;
            if ([] !== jA) j.released[k] = jA;
            if ([] !== jA0) j.released_today[k] = jA0;
            if ([] !== j1neg) j.latest_added[k] = j1neg;
            if ([] !== j3neg) j.latest_added2[k] = j3neg;
            if ([] !== j7neg) j.latest_added7[k] = j7neg;
          ////}
        });
        //_J[j.tag] = j;
        console.timeEnd('>> cache lists ' + j.tag);
      }
      resolve(1);
    });
  }

  async function load () {
    j = JSON.parse(data);
    datestr.textContent = j.date;
    end_pre.textContent = '更新时间 ' + j.date + '\n源代码 github.com/coronin/shanghai-2022Mar';
    tag_m.textContent = parseInt(j.tag.substr(0,2) );
    tag_d.textContent = parseInt(j.tag.substr(2,2) );
    let k;
    Ds = Object.keys(j.districts);
    await cacheList();
    As = Object.keys(j.address);
    console.log( j.address.shanghaifabu );
    for (i = 0; i < Ds.length; i += 1) {
      k = document.createElement('tr');
      // if (Ds[i] === '普陀区') {
      //   console.log( j.inB[ Ds[i] ] );
      //   console.log( j.today[ Ds[i] ] );
      // }
      if (j.released_today[ Ds[i] ] && j.released_today[ Ds[i] ].length ) {
        k.innerHTML = '<td>' + Ds[i] + '</td><td>' +
                      j.districts[ Ds[i] ].length + '</td><td id="' +
                      Ds[i] + 'dot" style="text-align:left;"></td><td>' +
                      (j.inB[ Ds[i] ] || []).length + '</td><td style="color:red;">' +
                      (j.today[ Ds[i] ] || []).length + '</td><td>' +
                      (j.released[ Ds[i] ] || []).length + '</td><td style="color:green;">' +
                      (j.released_today[ Ds[i] ] || []).length + '</td>';
      } else {
        k.innerHTML = '<td>' + Ds[i] + '</td><td>' +
                      j.districts[ Ds[i] ].length + '</td><td id="' +
                      Ds[i] + 'dot" style="text-align:left;"></td><td>' +
                      (j.inB[ Ds[i] ] || []).length + '</td><td style="color:red;">' +
                      (j.today[ Ds[i] ] || []).length + '</td><td>' +
                      (j.released[ Ds[i] ] || []).length + '</td><td style="color:green;">' +
                      '&ndash;</td>';
      }
      const hot_addresses = '' + Object.keys(hot_addr);
      if (hot_addresses.indexOf(Ds[i]) > -1) {
        th_hot.textContent = '中高风险';
        k.innerHTML += '<td style="color:purple;">' +
                       (hot_addresses.split(Ds[i]).length - 1) +
                       '处</td>';
      } else {
        k.innerHTML += '<td></td>';
      }
      k.id = Ds[i];
      districtTable.appendChild(k);
      k = document.createElement('p');
      if (j.latest_added && j.latest_added[ Ds[i] ]  && j.latest_added[ Ds[i] ].length ) {
        k.innerHTML = '<span style="color:black;">' + Ds[i] + '：今日涉及' +
                      j.today[ Ds[i] ].length +
                      '个地址（如下）</span> ' + j.latest_added[ Ds[i] ].length +
                      '个地址不同于昨日<br/>' + j.latest_added[ Ds[i] ] +
                      '<span style="color:grey;">' +
                      ((j.today[ Ds[i] ].length > j.latest_added[ Ds[i] ].length) ? ',' : '') +
                      [...j.today[Ds[i]]].filter(x => j.latest_added[Ds[i]].indexOf(x) === -1) +
                      '</span>';
      } else {
        k.innerHTML = '<span style="color:black;">' + Ds[i] + '：今日涉及' +
                      (j.today[ Ds[i] ] || []).length +
                      '个地址</span><br/><span style="color:grey;">' + j.today[ Ds[i] ] +
                      '</span>';
      }
      divToday.appendChild(k); // j.latest_added
      k = document.createElement('p');
      if (j.released_today && j.released_today[ Ds[i] ] && j.released_today[ Ds[i] ].length > 0) {
        k.innerHTML = '<span style="color:black;">' + Ds[i] + ':</span> ' + j.released_today[ Ds[i] ];
      } else {
        k.innerHTML = '<!-- span style="color:black;">' + Ds[i] + ': 无</span -->';
      }
      latest_released.appendChild(k);
      k = document.createElement('p');
      k.innerHTML = '<span style="color:green;font-weight:bold;">' + Ds[i] + ':</span> ' + j.released[ Ds[i] ];
      released.appendChild(k);
    }
  }

  function search () {
    let k = trim(addr.value);
    search_button.textContent = '搜索';
    console.log('Input', k);
    if (k.substr(0,4) === '浦东新区') {
      k = k.substr(4);
      addr.value = k;
    } else if (['上海市', '黄浦区', '静安区', '徐汇区', '长宁区',
                '普陀区', '虹口区', '杨浦区', '宝山区', '闵行区',
                '嘉定区', '金山区', '松江区', '青浦区', '奉贤区', '崇明区'].indexOf(
               k.substr(0,3) ) > -1) {
      k = k.substr(3);
      addr.value = k;
    }
    if (k === '') {
      addr.focus();
      return;
    }
    onList.textContent = '';
    let ii;
    for (ii = 0; ii < Ds.length; ii += 1) {
      document.getElementById(Ds[ii]).style.background = 'white';
      document.getElementById(Ds[ii] + 'dot').textContent = '';
    }
    let dl; let ks; let sb = 0;
    for (i = 0; i < As.length; i += 1) {
      if (As[i].indexOf(k) > -1) {
        dl = j.address[ As[i] ];
        let ij; let ik; let il = 0; let release;
        for (ii = 0; ii < Ds.length; ii += 1) {
          ij = j.districts[ Ds[ii] ];
          for (ik = 0; ik < ij.length; ik += 1) {
            if (ij[ik] === As[i]) {
              document.getElementById(Ds[ii]).style.background = 'yellow';
              document.getElementById(Ds[ii] + 'dot').textContent += '|';
              //console.log(Ds[ii]);
              il += 1;
              sb += 1;

        //onList.textContent += Ds[ii] + ',' + As[i] + ': ' + dl;
        if (sb < 10) {
          ks = '<span style="color:grey;"><span style="color:white;">0</span>' + sb + '.</span>';
        } else {
          ks = '<span style="color:grey;">' + sb + '.</span>';
        }
        ks += Ds[ii] +
              '<a href="https://sh.teach.bio/2?' +
              As[i] + '">' + As[i] + '</a> '; // maps.baidu.com/search/?querytype=s&wd=
        const s1 = dl.join(',').split(Ds[ii]);
        const s2 = s1[s1.length - 2];
        if (il === 1 || !s2) { // 地址同名, 团结村 国权北路555
          let dldl = -1;
          while (dl[dl.length + dldl].length !== 4) {
            dldl -= 1;
          }
          if (dl.slice(dldl)[0] === j.tag) {
            ks += '<span style="color:red">' + dl.join(', '
              ).replace(/030/g, '3/').replace(/040/g, '4/'
              ).replace(/050/g, '5/').replace(/060/g, '6/'
              ).replace(/070/g, '7/').replace(/07/g, '7/'
              ).replace(/03/g, '3/').replace(/05/g, '5/'
              ).replace(/04/g, '4/').replace(/06/g, '6/') + '</span>';
          } else {
            ks += dl.join(', '
              ).replace(/030/g, '3/').replace(/040/g, '4/'
              ).replace(/050/g, '5/').replace(/060/g, '6/'
              ).replace(/070/g, '7/').replace(/07/g, '7/'
              ).replace(/03/g, '3/').replace(/05/g, '5/'
              ).replace(/04/g, '4/').replace(/06/g, '6/');
          }
          release = parseInt(dl[dl.length + dldl]);
        } else {
          if (s2.substr(s2.lastIndexOf(',') + 1) === j.tag) {
            ks += '<span style="color:red">' + s2.substr(s2.lastIndexOf(',') + 1
              ).replace(/030/g, '3/').replace(/040/g, '4/'
              ).replace(/050/g, '5/').replace(/060/g, '6/'
              ).replace(/070/g, '7/').replace(/07/g, '7/'
              ).replace(/03/g, '3/').replace(/05/g, '5/'
              ).replace(/04/g, '4/').replace(/06/g, '6/') + '</span>';
          } else {
            ks += s2.substr(s2.lastIndexOf(',') + 1
              ).replace(/030/g, '3/').replace(/040/g, '4/'
              ).replace(/050/g, '5/').replace(/060/g, '6/'
              ).replace(/070/g, '7/').replace(/07/g, '7/'
              ).replace(/03/g, '3/').replace(/05/g, '5/'
              ).replace(/04/g, '4/').replace(/06/g, '6/');
          }
          release = parseInt( s2.substr(s2.lastIndexOf(',') + 1) );
        }
        release += (14 - 300);
        if (release < 32) {
          //onList.textContent += ' --> 4/' + release + '\n';
          ks += ' &rarr; 3/' + release +
                ' <span style="color:green">已满14天</span>';
        } else if (release < 131) { // release 4月30+1
          if (release > 100) {
            release -= 100;
          } else {
            release -= 31;
          }
          ks += ' &rarr; 4/' + release +
                ' <span style="color:green">已满14天</span>';
        } else if (release < 232) { // release 5月31+1
          if (release > 200) {
            release -= 200;
          } else {
            release -= 130;
          }
          ks += ' &rarr; 5/' + release +
                ' <span style="color:green">已满14天</span>';
        } else if (release < 331) { // 类似4月
          if (release > 300) {
            release -= 300;
          } else {
            release -= 231;
          }
          ks += ' &rarr; 6/' + release +
                ' <span style="color:green">已满14天</span>';
        } else {
          if (release > 400) { // 类似5月
            release -= 400;
          } else {
            release -= 330;
          }
          ks += ' &rarr; 7/' + release;
          if (release < today.getDate() ) {
            ks += ' <span style="color:green">已满14天</span>';
          } else if (release === today.getDate() ) {
            ks += '<span style="color:green">是第14天</span>';
          }
        }
        const kk = document.createElement('p');
        //kk.id = As[i];
        kk.style.padding = '0';
        kk.style.margin = '0';
        kk.innerHTML = ks;
        onList.appendChild(kk);

            }
          }
        }
      }
    }
    if (sb === 0) {
      addr.focus();
      search_button.textContent = '无结果，可输入再搜';
    } else {
      search_button.textContent = '查到' + sb + '个地址，可输入再搜';
    }
  }

  function show_full (item) {
    const t = document.getElementById(item).getAttribute('data-value');
    if (t === "1") {
      document.getElementById(item).style.display = 'block';
      if (document.getElementById(item + '_once')) {
        document.getElementById(item + '_once').style.visibility = 'hidden';
      }
      document.getElementById(item).setAttribute('data-value', "0");
    } else {
      document.getElementById(item).style.display = 'none';
      document.getElementById(item).setAttribute('data-value', "1");
    }
  }
  </script>
  <style>
    body {background-color:white;}
    p {line-height:1.5em;}
    .click {cursor:pointer;padding:0 .2em;box-shadow:inset 0 -.5em #d0d0d0;}
  </style>
</head>
<body onload="load();">
  <p>
    数据来源 <a href="https://wsjkw.sh.gov.cn/xwfb/index.html" target="_blank">shanghaifabu</a><br/>
    更新时间 <span id="datestr" style="color:blue;">fetching... not ready</span><br/>
    本页的<span style="background-color:yellow;">今日</span>为2022年<span id="tag_m"></span>月<span id="tag_d"></span>日
    <!--   j.tag-1    @@ -->
    搜索<a href="/#0713">昨日数据</a>
  </p>
  <p>
    <label for="addr">上榜地址</label>
    <input type="text" id="addr" name="addr" />
    <button id="search_button" onclick="search();">搜索</button>
  </p>
  <div style="width:100%;color:blue;" id="onList"></div>
  <h2>各区统计（地址数）</h2>
  <table id="districtTable" style="border:1px solid blue;color:blue;font-size:75%;text-align:center;">
    <tr style="color:black;"><th>行政单位</th><th>累计上榜</th><th></th><th>两周内</th><th>今日涉及</th>
      <th>累计下榜</th><th>今日下榜</th>
    <th id="th_hot" style="color:purple;"></th></tr>
  </table>
  <h2 onclick="show_full('divToday');" style="color:red;" class="click">今日涉及的地址</h2>
  <div style="color:red;list-style-type:none;font-size:75%;" id="divToday"></div>
  <h2 onclick="show_full('latest_released');" class="click">今日下榜的地址<i id="latest_released_once" style="color:grey;">点击显示</i></h2>
  <div style="color:green;list-style-type:none;font-size:75%;display:none;" id="latest_released" data-value="1"></div>
  <h2 onclick="show_full('released');" class="click">累计下榜的地址<i id="released_once" style="color:grey;">点击显示</i></h2>
  <div style="list-style-type:none;font-size:75%;display:none;" id="released" data-value="1"></div>
  <pre id="end_pre" style="color:grey">EOF</pre>
  <p><a href="https://support.qq.com/products/410541" target="blank">我要留言</a></p>
</body>
</html>